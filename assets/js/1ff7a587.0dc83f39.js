"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[5279],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>u});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=r.createContext({}),p=function(e){var n=r.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(i.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},_=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(t),_=o,u=d["".concat(i,".").concat(_)]||d[_]||m[_]||a;return t?r.createElement(u,l(l({ref:n},c),{},{components:t})):r.createElement(u,l({ref:n},c))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,l=new Array(a);l[0]=_;var s={};for(var i in n)hasOwnProperty.call(n,i)&&(s[i]=n[i]);s.originalType=e,s[d]="string"==typeof e?e:o,l[1]=s;for(var p=2;p<a;p++)l[p]=t[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,t)}_.displayName="MDXCreateElement"},1736:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=t(7462),o=(t(7294),t(3905));const a={sidebar_position:4},l="\ub9e5\ubbf8\ub2c8(Mac Server) \uc6b4\uc6a9 \ubc29\ubc95 - 3",s={unversionedId:"g-devops/common/dvop-c003",id:"g-devops/common/dvop-c003",title:"\ub9e5\ubbf8\ub2c8(Mac Server) \uc6b4\uc6a9 \ubc29\ubc95 - 3",description:"CodeServer - Nginx + https \uc124\uc815",source:"@site/docs/g-devops/common/dvop-c003.md",sourceDirName:"g-devops/common",slug:"/g-devops/common/dvop-c003",permalink:"/docs/g-devops/common/dvop-c003",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/g-devops/common/dvop-c003.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"DevOps",previous:{title:"\ub9e5\ubbf8\ub2c8(Mac Server) \uc6b4\uc6a9 \ubc29\ubc95 - 2",permalink:"/docs/g-devops/common/dvop-c002"}},i={},p=[{value:"CodeServer - Nginx + https \uc124\uc815",id:"codeserver---nginx--https-\uc124\uc815",level:2},{value:"\uac1c\uc694",id:"\uac1c\uc694",level:3},{value:"\ub3c4\uba54\uc778\uc744 \ubd99\uc774\uba74 \uc88b\uc740 \uc774\uc720 - \ub2e4\uc591\ud55c \uc11c\ube44\uc2a4 \uc5f0\uacb0",id:"\ub3c4\uba54\uc778\uc744-\ubd99\uc774\uba74-\uc88b\uc740-\uc774\uc720---\ub2e4\uc591\ud55c-\uc11c\ube44\uc2a4-\uc5f0\uacb0",level:3},{value:"\uc694\uc57d",id:"\uc694\uc57d",level:3},{value:"\uc0ac\uc804 \uc900\ube44",id:"\uc0ac\uc804-\uc900\ube44",level:3},{value:"NOTE) brew / nginx / certbot \uba85\ub839\uc5b4 \uc815\ub9ac",id:"note-brew--nginx--certbot-\uba85\ub839\uc5b4-\uc815\ub9ac",level:3},{value:"1. nginx \uc124\uce58",id:"1-nginx-\uc124\uce58",level:3},{value:"\uc124\uc815\ud30c\uc77c\uc5d0\uc11c 80 \ud3ec\ud2b8\ub85c \ubcc0\uacbd\ud574\uc11c nginx\uc811\uadfc\uc774 \ub418\ub294\uc9c0 \ud655\uc778 \ud574\ubcf4\uc790.",id:"\uc124\uc815\ud30c\uc77c\uc5d0\uc11c-80-\ud3ec\ud2b8\ub85c-\ubcc0\uacbd\ud574\uc11c-nginx\uc811\uadfc\uc774-\ub418\ub294\uc9c0-\ud655\uc778-\ud574\ubcf4\uc790",level:4},{value:"2. \ub3c4\uba54\uc778(\uac00\ube44\uc544) &gt; DNS \ub808\ucf54\ub4dc \uc218\uc815",id:"2-\ub3c4\uba54\uc778\uac00\ube44\uc544--dns-\ub808\ucf54\ub4dc-\uc218\uc815",level:3},{value:"3. \uc778\uc99d\uc11c \ubc1c\uae09",id:"3-\uc778\uc99d\uc11c-\ubc1c\uae09",level:3},{value:"4. \uc778\uc99d\uc11c \uac31\uc2e0",id:"4-\uc778\uc99d\uc11c-\uac31\uc2e0",level:3},{value:"cron job",id:"cron-job",level:4},{value:"\uc218\ub3d9 \uc791\uc5c5",id:"\uc218\ub3d9-\uc791\uc5c5",level:4},{value:"\ucd5c\uc885 nginx.conf",id:"\ucd5c\uc885-nginxconf",level:2},{value:"\uc608) \ucd5c\uc885 nginx.conf",id:"\uc608-\ucd5c\uc885-nginxconf",level:2},{value:"ref",id:"ref",level:2}],c={toc:p},d="wrapper";function m(e){let{components:n,...t}=e;return(0,o.kt)(d,(0,r.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"\ub9e5\ubbf8\ub2c8mac-server-\uc6b4\uc6a9-\ubc29\ubc95---3"},"\ub9e5\ubbf8\ub2c8(Mac Server) \uc6b4\uc6a9 \ubc29\ubc95 - 3"),(0,o.kt)("head",null,(0,o.kt)("meta",{name:"keywords",content:"Mac Server, \ub9e5\ubbf8\ub2c8 \uc11c\ubc84, \uc6b4\uc6a9"})),(0,o.kt)("h2",{id:"codeserver---nginx--https-\uc124\uc815"},"CodeServer - Nginx + https \uc124\uc815"),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"\uac1c\uc694"},"\uac1c\uc694"),(0,o.kt)("p",null,"\uc778\ud130\ub137\uc744 \ucc3e\uc544\ubcf4\ub2c8 code-server\uc5d0 https\ub97c \ubd99\uc774\uae30 \uc704\ud574\uc11c ",(0,o.kt)("inlineCode",{parentName:"p"},"nginx\ub97c \uc55e\ub2e8"),"\uc5d0 \ub450\ub294 \ubc29\uc2dd\uc744 \uc8fc\ub85c \uc0ac\uc6a9\ud588\ub2e4.    "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"ubuntu \ud658\uacbd\uc5d0\uc11c certbot\uc774 \uc27d\uac8c nginx\uc124\uc815\uc744 \ubc14\uafb8\uc5b4 \uc5f0\ub3d9\uc744 \ud574\uc8fc\ub294\ub370  "),(0,o.kt)("li",{parentName:"ul"},"MacOS\ud658\uacbd\uc5d0\uc11c brew\ub85c nginx\uc744 \uc124\uce58\ud588\ub2e4. "),(0,o.kt)("li",{parentName:"ul"},"nginx \uc124\uce58 \uacbd\ub85c\uac00 \uc6b0\ubd84\ud22c \ud658\uacbd\uacfc \ub2e4\ub974\uac8c \uc14b\uc5c5 \ub418\uc5c8\ub2e4. \uadf8\ub798\uc11c cerbot \uc790\ub3d9 \uc124\uc815(",(0,o.kt)("inlineCode",{parentName:"li"},"python3-certbot-nginx"),")\uc774 \uc2e4\ud328.."),(0,o.kt)("li",{parentName:"ul"},"\uadf8\ub798\uc11c cerbot \uc218\ub3d9\uc124\uc815 \ubc0f nginx conf\ub3c4 \uc9c1\uc811 \uc124\uc815\ud574\uc11c https \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud588\ub2e4.")),(0,o.kt)("p",null,"\ud06c\uac8c code-server\uc5d0 https\ub97c \ubd99\uc774\ub294 \ubc29\ubc95\uc740 ",(0,o.kt)("inlineCode",{parentName:"p"},"2\uac00\uc9c0\ub2e4"),". (\uc5ec\uae30\uc11c\ub294 1\ubc88 \ubc29\ubc95\uc744 \uae30\ub85d)  "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"https \uc778\uc99d\uc11c\ub97c nginx\uc5d0 \ubd99\uc774\uace0, \ub4b7\ub2e8\uc5d0 code-server \ub450\uae30  "),(0,o.kt)("li",{parentName:"ol"},"code-server\uc5d0 \uc9c1\uc811 https \uc778\uc99d\uc11c \ubd99\uc774\uae30   ")),(0,o.kt)("p",null,"1\ubc88 \ubc29\ubc95\uc774 \uc880 \ub354 \uc77c\ubc18\uc801\uc778 \uc0c1\ud669\uc5d0\uc11c \uc0ac\uc6a9\uc774 \uac00\ub2a5\ud558\uace0, cerbot\uc744 \uc774\uc6a9\ud574\uc11c \uc218\ub3d9\uc73c\ub85c https \uc778\uc99d\uc11c\ub97c \ubc1c\uae09\ud560 \uc608\uc815\uc774\ub2e4."),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"\ub3c4\uba54\uc778\uc744-\ubd99\uc774\uba74-\uc88b\uc740-\uc774\uc720---\ub2e4\uc591\ud55c-\uc11c\ube44\uc2a4-\uc5f0\uacb0"},"\ub3c4\uba54\uc778\uc744 \ubd99\uc774\uba74 \uc88b\uc740 \uc774\uc720 - \ub2e4\uc591\ud55c \uc11c\ube44\uc2a4 \uc5f0\uacb0"),(0,o.kt)("p",null,"\ub9e5\ubbf8\ub2c8 \uc11c\ubc84\ub97c \uc6b4\uc6a9\ud558\ub2e4\ubcf4\uba74, \uac01 \ud3ec\ud2b8\uc5d0 \uc5ec\ub7ec \uc11c\ube44\uc2a4\ub97c \ub9cc\ub4e4\uac8c \ub41c\ub2e4.\n\uc608\ub97c\ub4e4\uc5b4, "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"3000 \ub9ac\uc561\ud2b8 \uc11c\ubc84\n4000 api \uc11c\ubc84\n5432 db \uc11c\ubc84\n5555 redis \uc11c\ubc84\n8090 jeknins \uc11c\ubc84\n9009 portainer \uc11c\ubc84\n")),(0,o.kt)("p",null,"\ub9e4\ubc88 \ub0b4 \uc544\uc774\ud53c \uc8fc\uc18c\uc5d0 \ud3ec\ud2b8\ub97c \ubd99\uc5ec\uc11c \uc811\uadfc\ud574\ub3c4 \ub418\uc9c0\ub9cc, \uc678\ubd80\uc5d0 \uc11c\ube44\uc2a4\ub97c \ub178\ucd9c\ud560\ub54c\ub294 \uadf8\ub807\uac8c \ud558\uc9c0 \uc54a\ub294\ub2e4.\n\ub3c4\uba54\uc778\uc744 \ubd99\uc774\ub294\uac83\uc774\ub2e4. \ub3c4\uba54\uc778 example.com\uc744 \uad6c\ub9e4\ud574\uc11c \ub2e4\uc74c\ucc98\ub7fc \uad6c\uc131\uc774 \uac00\ub2a5\ud558\ub2e4."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"www.example.com -> 3000 \ub9ac\uc561\ud2b8 \uc11c\ubc84\napi.example.com -> 4000 api \uc11c\ubc84\ndb.example.com -> 5432 db \uc11c\ubc84\ncache.example.com -> 5555 redis \uc11c\ubc84\njekins.example.com -> 8090 jeknins \uc11c\ubc84\nci.example.com -> 9009 portainer \uc11c\ubc84\n")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"\uc694\uc57d"},"\uc694\uc57d"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\ub3c4\uba54\uc778 \uc124\uc815")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\ub3c4\uba54\uc778\uc744 \uad6c\ub9e4\ud55c\ub2e4. eg) ",(0,o.kt)("a",{parentName:"li",href:"http://www.example.com"},"www.example.com")),(0,o.kt)("li",{parentName:"ul"},"DNS \ub798\ucf54\ub4dc \uc124\uc815\uc73c\ub85c \ub0b4 \uc544\uc774\ud53c\uc640 \uc5f0\uacb0\ud55c\ub2e4. eg) ",(0,o.kt)("a",{parentName:"li",href:"http://www.example.com"},"www.example.com")," -> 123.123.123.123")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"nginx 80 port \uc124\uc815")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\ub9e5\ubbf8\ub2c8\uc758 80\ud3ec\ud2b8 \uc811\uc18d = nginx\ub85c \uc14b\uc5c5"),(0,o.kt)("li",{parentName:"ul"},"\ub9c8\uce58 GW \uac19\uc740 \uc5ed\ud559\uc744 nginx\uac00 \ud574\uc8fc\ub294 \uac83\uc774\ub2e4.  "),(0,o.kt)("li",{parentName:"ul"},"\uadf8\ub9ac\uace0 \uac01 \ub3c4\uba54\uc778 \ubcc4\ub85c \ubd84\uae30\ucc98\ub9ac \ud558\uc5ec, \ub4b7\ub2e8\uc758 \uc11c\ube44\uc2a4 \ud3ec\ud2b8\ub85c \uc5f0\uacb0\ud55c\ub2e4.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    server {\n        listen 80 ; # nginx\ub294 80\ud3ec\ud2b8 opn  \n        server_name www.example.com; # \uadf8 \uc911 \ud2b9\uc815 \ub3c4\uba54\uc778\uc5d0 \ud574\ub2f9\ud558\ub294 \uacbd\uc6b0\ub9cc \ucc98\ub9ac\ud55c\ub2e4.\n\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n        }\n    }\n")),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"cerbot \uc2e4\ud589")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"sudo certbot certonly --manual"),"\uc73c\ub85c \uc778\uc99d\uc11c\ubc1c\uae09 \uc9c4\ud589"),(0,o.kt)("li",{parentName:"ul"},"cerbot\uc5d0\uc11c \uc784\uc758\uc758 \uacbd\ub85c\uc5d0 \uc694\uccad\uc744 \ubcf4\ub0bc\ud14c\ub2c8, \ud2b9\uc815 \ud30c\uc77c\uc744 \uc77d\uc744 \uc218 \uc788\ub3c4\ub85d \uc14b\ud305\ud558\ub77c \ud55c\ub2e4."),(0,o.kt)("li",{parentName:"ul"},"\uadf8 \uc124\uc815\uc744 / \uc55e\ub2e8\uc5d0 \ud55c\ub2e4.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    server {\n        listen 80 ; # nginx\ub294 80\ud3ec\ud2b8 opn  \n        server_name www.example.com; # \uadf8 \uc911 \ud2b9\uc815 \ub3c4\uba54\uc778\uc5d0 \ud574\ub2f9\ud558\ub294 \uacbd\uc6b0\ub9cc \ucc98\ub9ac\ud55c\ub2e4. \n\n        location /.well-known/acme-challenge {\n            alias /opt/homebrew/etc/nginx/.well-known/acme-challenge; # \uc2e4\uc81c \ud30c\uc77c\uc774 \uc704\uce58\ud55c \uacbd\ub85c\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\n            try_files $uri $uri/ /opt/homebrew/etc/nginx/.well-known/acme-challenge/EaICkPAIxkrb_MYWJPqLihzZCc228BkrgxXPvi9qUTA; # \ud2b9\uc815 \ud30c\uc77c\uba85\uc744 \uc5ec\uae30\uc5d0 \uc9c0\uc815\ud569\ub2c8\ub2e4.\n        }\n\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n        }\n    }\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"nginx 443 port \uc124\uc815")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\uc778\uc99d\uc774 \uc131\uacf5\ub418\uba74, \ud2b9\uc815 \uacbd\ub85c\uc5d0 \uc778\uc99d\uc11c\ub97c \ub9cc\ub4e4\uc5b4\uc8fc\uac8c \ub41c\ub2e4."),(0,o.kt)("li",{parentName:"ul"},"\uc774\ub294 fullchain.pem, privkey.pem 2\uac1c\uac00 \ub098\uc628\ub2e4."),(0,o.kt)("li",{parentName:"ul"},"\ud574\ub2f9 \ub514\ub809\ud130\ub9ac\ub294 nginx\uac00 \uc77d\uc744\uad8c\ud55c\uc774 \uc5c6\uc73c\ubbc0\ub85c ",(0,o.kt)("inlineCode",{parentName:"li"},"sudo chmod -R 755 /etc/letsencrypt")," \uba85\ub839\uc5b4\ub85c \uad8c\ud55c \ubd80\uc5ec"),(0,o.kt)("li",{parentName:"ul"},"\ub2e4\uc74c\ucc98\ub7fc \uc124\uc815\uc744 \ucd94\uac00\ud55c\ub2e4. (\uc544\ub798 \uc608\uc81c\ub294 localhost 3030\ud3ec\ud2b8\ub85c \uc9c4\uc785\ud55c\ub2e4.)")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"    server {\n        listen 443 ssl; \n        server_name www.example.com; \n        ssl_certificate /etc/letsencrypt/live/www.example.com/fullchain.pem; \n        ssl_certificate_key /etc/letsencrypt/live/www.example.com/privkey.pem; \n\n        # SSL \uc124\uc815 (\ucd5c\uc2e0 \ubcf4\uc548 \uad8c\uc7a5)\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';\n        ssl_prefer_server_ciphers off;\n\n        # SSL \uc138\uc158 \uce90\uc2f1 \uc124\uc815\n        ssl_session_cache shared:SSL:10m;\n        ssl_session_timeout 1h;\n\n        location / {\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Host $host;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_pass http://127.0.0.1:3030/;\n        }   \n    }\n")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"\uc0ac\uc804-\uc900\ube44"},"\uc0ac\uc804 \uc900\ube44"),(0,o.kt)("p",null,"\ub0b4 \uc544\uc774\ud53c \ud655\uc778\ud558\uae30 "),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"MY_IP = 123.123.123.123 ")),(0,o.kt)("p",null,"\ub3c4\uba54\uc778 \uad6c\ub9e4\ud558\uae30 (\uac00\ube44\uc544)"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\uac00\ube44\uc544\uc5d0\uc11c 2000\uc6d0,1\ub144 \ub3c4\uba54\uc778\uc744 \uad6c\ub9e4\ud588\ub2e4."),(0,o.kt)("li",{parentName:"ul"},"MY_DOMAIN = ",(0,o.kt)("a",{parentName:"li",href:"http://www.my-coding.site"},"www.my-coding.site")," ")),(0,o.kt)("p",null,"iptime port forward \ud655\uc778"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"80, 443 \ud3ec\ud2b8\uac00 \ub9e5\uc11c\ubc84\uc640 \uc5f0\uacb0\ub418\uc5c8\ub294\uc9c0 \ubc18\ub4dc\uc2dc \ud655\uc778")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"note-brew--nginx--certbot-\uba85\ub839\uc5b4-\uc815\ub9ac"},"NOTE) brew / nginx / certbot \uba85\ub839\uc5b4 \uc815\ub9ac"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[brew]\nbrew search nginx   # \ud328\ud0a4\uc9c0 \uac80\uc0c9 \nbrew install nginx  # \ud328\ud0a4\uc9c0 \uc124\uce58\n\nbrew services start nginx  # \uc11c\ube44\uc2a4 \uc2dc\uc791\nbrew services restart nginx \n( brew services [run|start|stop|restart|cleanup] service_name  )\n\nbrew services # \uc11c\ube44\uc2a4 \ud655\uc778\nName        Status  User      File\nnginx       started dosimpact ~/Library/LaunchAgents/homebrew.mxcl.nginx.plist\n\n---\n\n[nginx]\n# \uc124\uc815\ud30c\uc77c \ubcc0\uacbd \ud6c4 \ubb38\ubc95 \uccb4\ud06c\ud558\uae30\nnginx -t \n\n# nginx.conf \ud30c\uc77c \uacbd\ub85c \ud655\uc778\nbrew info nginx\n...\nThe default port has been set in /opt/homebrew/etc/nginx/nginx.conf to 8080 so that\nnginx can run without sudo.\n...\n\n# nginx root \ud3f4\ub354 \ud655\uc778 \n>nginx -V\n\nnginx version: nginx/1.25.1 ...\nconfigure arguments: --prefix=/opt/homebrew/Cellar/nginx/1.25.1_1 ...\n\n\uc5ec\uae30\uc11c : --prefix=/opt/homebrew/Cellar/nginx/1.25.1_1 \uc5d0 \ub8e8\ud2b8 \ub514\ub809\ud130\ub9ac\uac00 \ub41c\ub2e4.\n\ud558\uc9c0\ub9cc \ud574\ub2f9 \ub514\ub809\ud130\ub9ac\uc758 html \ud3f4\ub354\ub294 \ub9c1\ud06c\uac00 \uac78\ub824 \uc788\ub2e4. \n\ucd5c\uc885\uc801\uc73c\ub85c /opt/homebrew/var/www \ub77c\ub294 \uacf3\uc5d0 index.html \uc774 \uc788\ub2e4. \n\n---\n[certbot]\n# \uc778\uc99d\uc11c \uc815\ubcf4 , \uc720\ud6a8\uae30\uac04, \uacbd\ub85c \ud655\uc778 \nsudo certbot certificates\n\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: MY_DOMAIN\n    Serial Number: 3841dcd9246507891a8afc5cde8df0e0af1\n    Key Type: ECDSA\n    Domains: MY_DOMAIN\n    Expiry Date: 2023-11-08 12:19:45+00:00 (VALID: 89 days)\n    Certificate Path: /etc/letsencrypt/live/MY_DOMAIN/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/MY_DOMAIN/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\n# \uc778\uc99d\uc11c \uac31\uc2e0 dry-run\nsudo certbot renew --dry-run\n\n# \uc778\uc99d\uc11c \uac31\uc2e0\nsudo certbot renew\n\n")),(0,o.kt)("h3",{id:"1-nginx-\uc124\uce58"},"1. nginx \uc124\uce58"),(0,o.kt)("p",null,"\uc544\ub798 \uba85\ub839\uc5b4\ub97c \ucc38\uace0\ud574\uc11c nginx\ub97c MacOS\uc5d0 \uc124\uce58\ud55c\ub2e4.   "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#1 \ud328\ud0a4\uc9c0 \uc124\uce58\nbrew install nginx \n\n#2 \uc11c\ube44\uc2a4 \uc2dc\uc791\nbrew services start nginx\n\n#3 \uc11c\ube44\uc2a4 \ubaa9\ub85d\nbrew services\n\n# \uc11c\ube44\uc2a4 \uc7ac\uc2dc\uc791\nbrew services restart nginx\n\n#4 8080\ud3ec\ud2b8 \uc811\uadfc\uc2dc nginx \ub3c4\ub2ec \ud655\uc778\ud558\uc790.\n> http://123.123.123.123:8080/\n")),(0,o.kt)("br",null),(0,o.kt)("h4",{id:"\uc124\uc815\ud30c\uc77c\uc5d0\uc11c-80-\ud3ec\ud2b8\ub85c-\ubcc0\uacbd\ud574\uc11c-nginx\uc811\uadfc\uc774-\ub418\ub294\uc9c0-\ud655\uc778-\ud574\ubcf4\uc790"},"\uc124\uc815\ud30c\uc77c\uc5d0\uc11c 80 \ud3ec\ud2b8\ub85c \ubcc0\uacbd\ud574\uc11c nginx\uc811\uadfc\uc774 \ub418\ub294\uc9c0 \ud655\uc778 \ud574\ubcf4\uc790."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# 1. nginx.conf \ud30c\uc77c \uacbd\ub85c \ud655\uc778\nbrew info nginx\n\n# 1.1 \uc544\ub798\ucc98\ub7fc \uc124\uc815\ud30c\uc77c \uacbd\ub85c\ub97c \ud655\uc778 \n...\nThe default port has been set in /opt/homebrew/etc/nginx/nginx.conf to 8080 so that\nnginx can run without sudo.\n...\n\n# 2. \uc124\uc815 \ud30c\uc77c \ubcc0\uacbd\n\uc124\uc815 \ud30c\uc77c \uacbd\ub85c : /opt/homebrew/etc/nginx/nginx.conf\n  - \ud3ec\ud2b8 8080 > 80 \ubcc0\uacbd\n\n#3. \uc11c\ube44\uc2a4 \uc7ac\uc2dc\uc791\nbrew services restart nginx\n\n#3 nginx \ub3c4\ub2ec \ud655\uc778 (port 80)\n> http://123.123.123.123/\n")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"2-\ub3c4\uba54\uc778\uac00\ube44\uc544--dns-\ub808\ucf54\ub4dc-\uc218\uc815"},"2. \ub3c4\uba54\uc778(\uac00\ube44\uc544) > DNS \ub808\ucf54\ub4dc \uc218\uc815"),(0,o.kt)("p",null,"my-coding.site \ub3c4\uba54\uc778\uc744 \uad6c\ub9e4 \ud6c4",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"http://www.my-coding.site"},"www.my-coding.site")," \ub3c4\uba54\uc778\uacfc \ub0b4 \ub9e5\ubbf8\ub2c8 \uc11c\ubc84\uc640 \uc5f0\uacb0\ud574\uc57c \ud55c\ub2e4.  "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#1 A \ud0c0\uc785\uc73c\ub85c \ub808\ucf54\ub4dc\ub97c \ucd94\uac00\ud55c\ub2e4. \n- eg) www.my-coding.site -> 123.123.123.123 \uc124\uc815\uc744 \uc6d0\ud55c\ub2e4\uba74\n- host:www\n- host \ub294 www \uc774\uba70 \uc11c\ube0c\ub3c4\uba54\uc778\uc744 \ub73b\ud55c\ub2e4. \n\n# \ucc38\uace0)\n- eg) my-coding.site -> 123.123.123.123 \uc124\uc815\uc744 \uc6d0\ud55c\ub2e4\uba74\n- host:@\n- Note) host\uc5d0 @\uc740 \uc11c\ube0c\ub3c4\uba54\uc778\uc774 \uc5c6\ub294 \uacbd\uc6b0\uc774\ub2e4.\n- \uc989, http://my-coding.site / \ub85c \uc811\uc18d\ud558\uba74 \uc9c0\uc815\ub41c IP\ub85c \uc774\ub3d9\ud55c\ub2e4.\n\n#2 nginx \ub3c4\ub2ec \ud655\uc778\n>http://www.my-coding.site \n\n")),(0,o.kt)("br",null),(0,o.kt)("h3",{id:"3-\uc778\uc99d\uc11c-\ubc1c\uae09"},"3. \uc778\uc99d\uc11c \ubc1c\uae09"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://ukprog.tistory.com/125"},"https://ukprog.tistory.com/125")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# 1. \uc778\uc99d\uc11c \ubc1c\uae09 \uc2dc\uc791\nsudo certbot certonly --manual \n\n# 2. \uc5f0\uacb0\ud560 \ub3c4\uba54\uc778 \uc785\ub825\nwww.my-coding.site\n\n# \ub3c4\uba54\uc778\uc5d0 \uc544\ub798 \ud30c\uc77c \uc11c\ube59\ud558\ub3c4\ub85d nginx \uc124\uc815 \ubcc0\uacbd\nCreate a file containing just this data:\nEmu_LEu_HbaAeKH6OrOER88xvjurfFKRJM7-MoYhjN9.HpJsIlJVhSaVM-6mjKz5_4ZU5tydqNW2B5pjcvuHjS0\nAnd make it available on your web server at this URL:\nhttp://www.my-coding.site/.well-known/acme-challenge/Emu_LEu_HbaAeKH6OrOER88xvjurfFKRJM7-MoYhjN9\n\n\n# nginx.conf \ucd94\uac00\n---\n    server {\n        listen 80 ;\n        server_name www.my-coding.site;\n\n        location /.well-known/acme-challenge {\n            alias /opt/homebrew/etc/nginx/.well-known/acme-challenge; # \uc2e4\uc81c \ud30c\uc77c\uc774 \uc704\uce58\ud55c \uacbd\ub85c\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\n            try_files $uri $uri/ /opt/homebrew/etc/nginx/.well-known/acme-challenge/Emu_LEu_HbaAeKH6OrOER88xvjurfFKRJM7-MoYhjN9; # \ud2b9\uc815 \ud30c\uc77c\uba85\uc744 \uc5ec\uae30\uc5d0 \uc9c0\uc815\ud569\ub2c8\ub2e4.\n        }\n\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n        }\n    }\n...\n\n--- \n\nmkdir -p .well-known/acme-challenge/\nvi Emu_LEu_HbaAeKH6OrOER88xvjurfFKRJM7-MoYhjN8\nEmu_LEu_HbaAeKH6OrOER88xvjurfFKRJM7-MoYhjN8.HpJsIlJVhSaVM-6mjKz5_4ZU5tydqNW2B5pjcvuHjS0  \uc785\ub825 \ud6c4 \uc800\uc7a5\n\n#3. nginx \uc7ac\uc2e4\ud589\nnginx -t # \ubb38\ubc95 \uac80\uc0ac\nbrew services restart nginx # \uc7ac\uc2dc\uc791 \n\n#4. cerbot \ud655\uc778 \ud6c4 \ubc1c\uae09 \uc131\uacf5\nSuccessfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/www.my-coding.site /fullchain.pem\nKey is saved at:         /etc/letsencrypt/live/www.my-coding.site /privkey.pem\nThis certificate expires on 2023-11-08.\nThese files will be updated when the certificate renews.\n\n\n#5. \uc778\uc99d\uc11c \uc77d\uae30 \uad8c\ud55c \ubb38\uc81c \ud574\uacb0\nsudo chmod -R 755 /etc/letsencrypt\n\n#6. https \ucc98\ub9ac\ud558\ub294 nginx.conf \ucd94\uac00\n\n---\n    server {\n        listen 443 ssl; \n        server_name www.my-coding.site; \n        ssl_certificate /etc/letsencrypt/live/www.my-coding.site/fullchain.pem; \n        ssl_certificate_key /etc/letsencrypt/live/www.my-coding.site/privkey.pem; \n\n        # SSL \uc124\uc815 (\ucd5c\uc2e0 \ubcf4\uc548 \uad8c\uc7a5)\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';\n        ssl_prefer_server_ciphers off;\n\n        # SSL \uc138\uc158 \uce90\uc2f1 \uc124\uc815\n        ssl_session_cache shared:SSL:10m;\n        ssl_session_timeout 1h;\n\n        location / {\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Host $host;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_pass http://127.0.0.1:3030/;\n        }   \n    }\n...\n\n")),(0,o.kt)("h3",{id:"4-\uc778\uc99d\uc11c-\uac31\uc2e0"},"4. \uc778\uc99d\uc11c \uac31\uc2e0"),(0,o.kt)("h4",{id:"cron-job"},"cron job"),(0,o.kt)("p",null,'echo "0 0,12 * * ',(0,o.kt)("em",{parentName:"p"}," root python -c 'import random; import time; time.sleep(random.random() ")," 3600)' && certbot renew -q\" | sudo tee -a /etc/crontab > /dev/null"),(0,o.kt)("h4",{id:"\uc218\ub3d9-\uc791\uc5c5"},"\uc218\ub3d9 \uc791\uc5c5"),(0,o.kt)("p",null,"( nginx \uacbd\ub85c\ub85c \uc624\ub958 > sudo certbot --nginx -d ",(0,o.kt)("a",{parentName:"p",href:"http://www.my-coding.site"},"www.my-coding.site"),"  )"),(0,o.kt)("h2",{id:"\ucd5c\uc885-nginxconf"},"\ucd5c\uc885 nginx.conf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-c"},"#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n#pid        logs/nginx.pid;\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n    #gzip  on;\n\n    server {\n        listen 443 ssl; # managed by Certbot\n        server_name www.you-domain.site; # managed by Certbot\n        ssl_certificate /opt/homebrew/etc/nginx/fullchain.pem; # managed by Certbot\n        ssl_certificate_key /opt/homebrew/etc/nginx/privkey.pem; # managed by Certbot\n        # SSL \uc124\uc815 \ucd94\uac00 (optional, \ucd94\ucc9c)\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384';\n        ssl_prefer_server_ciphers off;\n        ssl_session_timeout 1d;\n        ssl_session_cache shared:SSL:50m;\n\n        location / {\n            proxy_pass http://127.0.0.1:2229/;           \n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection upgrade;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }   \n    }\n\n    server {\n        listen 80 ;\n        server_name www.you-domain.site;\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n        }\n    }\n\n    include servers/*;\n}\n")),(0,o.kt)("h2",{id:"\uc608-\ucd5c\uc885-nginxconf"},"\uc608) \ucd5c\uc885 nginx.conf"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"#user  nobody;\nworker_processes  1;\n\n#error_log  logs/error.log;\n#error_log  logs/error.log  notice;\n#error_log  logs/error.log  info;\n#pid        logs/nginx.pid;\nevents {\n    worker_connections  1024;\n}\n\n\nhttp {\n    include       mime.types;\n    default_type  application/octet-stream;\n\n    #log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n    #                  '$status $body_bytes_sent \"$http_referer\" '\n    #                  '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    #access_log  logs/access.log  main;\n\n    sendfile        on;\n    #tcp_nopush     on;\n    #keepalive_timeout  0;\n    keepalive_timeout  65;\n    #gzip  on;\n\n    # ghost cms - coding-play\n    server {\n        listen 80 ;\n        server_name wp.coding-play.site;\n\n        location /.well-known/acme-challenge {\n            alias /opt/homebrew/etc/nginx/.well-known/acme-challenge; # \uc2e4\uc81c \ud30c\uc77c\uc774 \uc704\uce58\ud55c \uacbd\ub85c\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\n            try_files $uri $uri/ /opt/homebrew/etc/nginx/.well-known/acme-challenge/GA8XfAQnDC7jp1kjtxMmzhUJ5RVeYWG0MbwfdnH1JXQ; # \ud2b9\uc815 \ud30c\uc77c\uba85\uc744 \uc5ec\uae30\uc5d0 \uc9c0\uc815\ud569\ub2c8\ub2e4.\n        }\n\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n            # proxy_pass http://127.0.0.1:8080;\n        }\n        # location ~ /.well-known {\n        #     allow all;\n        # }\n    }\n\n    server {\n        listen 443 ssl; \n        server_name wp.coding-play.site; \n        ssl_certificate /etc/letsencrypt/live/wp.coding-play.site/fullchain.pem; \n        ssl_certificate_key /etc/letsencrypt/live/wp.coding-play.site/privkey.pem; \n\n        # SSL \uc124\uc815 (\ucd5c\uc2e0 \ubcf4\uc548 \uad8c\uc7a5)\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384';\n        ssl_prefer_server_ciphers off;\n\n        # SSL \uc138\uc158 \uce90\uc2f1 \uc124\uc815\n        ssl_session_cache shared:SSL:10m;\n        ssl_session_timeout 1h;\n\n        location / {\n            # proxy_set_header Host \"wp.coding-play.site\";\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Host $host;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            # proxy_set_header X-Real-IP $remote_addr;\n            # proxy_set_header Host $http_host;\n            # proxy_set_header X-NginX-Proxy true;\n            # proxy_redirect off;\n            proxy_pass http://127.0.0.1:3030/;\n\n\n            # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            # proxy_set_header X-Forwarded-Proto $scheme;\n            # proxy_set_header X-Real-IP $remote_addr;\n            # proxy_set_header Host $http_host;\n        }   \n    }\n\n    # vscode\n    server {\n        listen 443 ssl; \n        server_name code.coding-play.site; \n        ssl_certificate /etc/letsencrypt/live/code.coding-play.site/fullchain.pem; \n        ssl_certificate_key /etc/letsencrypt/live/code.coding-play.site/privkey.pem; \n\n        # SSL \uc124\uc815 \ucd94\uac00 (optional, \ucd94\ucc9c)\n        ssl_protocols TLSv1.2 TLSv1.3;\n        ssl_ciphers 'TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384';\n        # ssl_prefer_server_ciphers off;\n        # ssl_session_timeout 1d;\n        # ssl_session_cache shared:SSL:50m;\n\n\n        location / {\n            proxy_pass http://127.0.0.1:2229;           \n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection upgrade;\n            proxy_set_header Host $host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n        }   \n    }\n\n    server {\n        listen 80 ;\n        server_name code.coding-play.site;\n\n        location /.well-known/acme-challenge {\n            alias /opt/homebrew/etc/nginx/.well-known/acme-challenge; # \uc2e4\uc81c \ud30c\uc77c\uc774 \uc704\uce58\ud55c \uacbd\ub85c\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\n            try_files $uri $uri/ /opt/homebrew/etc/nginx/.well-known/acme-challenge/XGNhDLRm4LMqNgFd3QC3RdI4mGM1ZedPYZiSt0nTCUY; # \ud2b9\uc815 \ud30c\uc77c\uba85\uc744 \uc5ec\uae30\uc5d0 \uc9c0\uc815\ud569\ub2c8\ub2e4.\n        }\n\n        location / {  # HTTP to HTTPS \ub9ac\ub514\ub809\uc158\n            return 301 https://$host$request_uri;\n        }\n    }\n\n    include servers/*;\n}\n\n# nginx -t\n# brew services restart nginx\n# sudo chmod -R 755 /etc/letsencrypt\n")),(0,o.kt)("h2",{id:"ref"},"ref"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://www.delmaster.net/69"},"DNS \ub808\ucf54\ub4dc \uc885\ub958"),".",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://inpa.tistory.com/entry/WEB-%F0%9F%8C%90-DNS-%EB%A0%88%EC%BD%94%EB%93%9C-%EC%A2%85%EB%A5%98-%E2%98%85-%EC%95%8C%EA%B8%B0-%EC%89%BD%EA%B2%8C-%EC%A0%95%EB%A6%AC"},"DNS \ub808\ucf54\ub4dc \uc885\ub958 \uc27d\uac8c \uc774\ud574"),".",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://dev-repository.tistory.com/96"},"ssh \uc811\uc18d to mac mini"),(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://www.hakawati.co.kr/entry/Code-Server-%EA%B5%AC%EC%B6%95%ED%8E%B8#NginX%EC%9D%98%20%ED%8C%A8%EC%8A%A4%EC%9B%8C%EB%93%9C%20%EC%9D%B8%EC%A6%9D%20%EA%B5%AC%EC%84%B1-1"},"nginx + code-server \uad6c\ucd95"),".",(0,o.kt)("br",{parentName:"p"}),"\n",(0,o.kt)("a",{parentName:"p",href:"https://donghun.dev/code-server-tutorial-guide"},"code-server \uc790\uccb4\uc5d0 https \uc801\uc6a9")))}m.isMDXComponent=!0}}]);